{% extends "aggregator/base.html" %}

{% block content %}

<div class="page-header">
  <h1>HyperMap Home Page</h1>
</div>

  {% if services %}
      <div class="row">
        <div class="col-md-12">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Type</th>
                <th>Name</th>
                <th>Layers</th>
                <th>Last Check</th>
                <th>Status</th>
                <th>Response Times</th>
                <th>Reliability</th>
              </tr>
            </thead>
            <tbody>
              {% for service in services %}
                {% if service.checks_count > 0 %}
                  <tr>
                    <td>{{ service.get_type_display }}</td>
                    <td>
                      <strong>{{ service.get_domain }}</strong>
                      <br /><a href="{% url 'service_detail' service.id %}">{{ service.title|truncatechars:40 }}</a>
                      <br /><a href="{{ service.url }}">{{ service.url|truncatechars:40 }}</a>
                    </td>
                    <td>{{ service.layer_set.all.count }}</td>
                    <td>
                      <ul>
                        <li>{{ service.last_updated }}</li>
                        <li>{{ service.last_response_time|floatformat:2 }}s</li>
                    </ul>
                    </td>
                    <td>
                      {% if service.last_check %}
                        <button type="button" class="btn btn-success btn-circle btn nohover"><i class="fa fa-check"></i></button>
                      {% else %}
                        <button type="button" class="btn btn-danger btn-circle btn nohover"><i class="fa fa-check"></i></button>
                      {% endif %}
                    </td>
                    <td>
                      <ul>
                        <li>Min: {{ service.min_response_time|floatformat:2 }}s</li>
                        <li>Average: {{ service.average_response_time|floatformat:2 }}s</li>
                        <li>Max: {{ service.max_response_time|floatformat:2 }}s</li>
                      </ul>
                    </td>
                    <td>
                      {% if service.reliability > 97 %}
                        <button type="button" class="btn btn-success btn-block nohover">{{ service.reliability|floatformat:2 }}%</button>
                      {% else %}
                        <button type="button" class="btn btn-danger btn-block nohover">{{ service.reliability|floatformat:2 }}%</button>
                      {% endif %}
                    </td>
                  </tr>
                {% endif %}
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
  {% else %}
      <p>No services are available.</p>
  {% endif %}

{% endblock %}
